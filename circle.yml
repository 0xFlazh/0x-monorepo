machine:
  node:
    version: 6.5.0
  environment:
      YARN_VERSION: 0.28.4
      CONTRACTS_COMMIT_HASH: '78fe8dd'
      PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

dependencies:
  override:
    - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version $YARN_VERSION
    - yarn install --pure-lockfile
  cache_directories:
    - ~/.cache/yarn

test:
  override:
    - wget https://s3.amazonaws.com/testrpc-shapshots/${CONTRACTS_COMMIT_HASH}.zip
    - unzip ${CONTRACTS_COMMIT_HASH}.zip -d testrpc_snapshot
    - npm run testrpc -- --db testrpc_snapshot:
        background: true
    - ./node_modules/lerna/bin/lerna run test:coverage
    - ./node_modules/lerna/bin/lerna run report_test_coverage
    - if [ $CIRCLE_BRANCH = "master" ]; then ./node_modules/lerna/bin/lerna run test:umd; fi
    - ./node_modules/lerna/bin/lerna run lint
